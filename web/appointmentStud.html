<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Appointment Booking</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- KEEPING YOUR EXISTING STYLES --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { display: flex; background-color: #f8f7fc; color: #333; min-height: 100vh; }
        
        /* Sidebar Styles */
        .sidebar { width: 280px; background: #51245C; color: white; height: 100vh; position: fixed; left: 0; top: 0; overflow-y: auto; box-shadow: 4px 0 15px rgba(203, 149, 232, 0.2); z-index: 100; }
        .sidebar-header { padding: 30px 25px; border-bottom: 1px solid rgba(255, 255, 255, 0.2); text-align: center; background: rgba(255, 255, 255, 0.1); }
        .user-info .avatar { width: 80px; height: 80px; background: linear-gradient(135deg, #a56cd1 0%, #8a4ec7 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-weight: bold; font-size: 2.2em; border: 3px solid rgba(255, 255, 255, 0.3); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); }
        .user-info p { font-weight: 600; margin-bottom: 8px; font-size: 1.3em; color: white; }
        .user-info small { display: block; color: rgba(255, 255, 255, 0.9); font-size: 0.9em; margin-bottom: 5px; }
        .sidebar-menu { list-style: none; padding: 25px 0; }
        .sidebar-menu li a { display: flex; align-items: center; padding: 16px 30px; color: rgba(255, 255, 255, 0.9); text-decoration: none; transition: all 0.3s ease; border-left: 4px solid transparent; font-size: 1.1em; }
        .sidebar-menu li a i { margin-right: 15px; font-size: 1.3em; width: 24px; text-align: center; }
        .sidebar-menu li.active a { background: rgba(255, 255, 255, 0.2); color: white; border-left-color: #FFB347; font-weight: 500; }
        .sidebar-menu li a:hover { background: rgba(255, 255, 255, 0.15); padding-left: 35px; }

        /* Main Content Styles */
        .main-content { flex: 1; margin-left: 280px; padding: 40px; min-height: 100vh; }
        .booking-container { background: white; border-radius: 20px; padding: 40px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); max-width: 1000px; margin: 0 auto; }
        .section-label { color: #51245C; font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 1.1em; }
        .date-input-container { margin-bottom: 25px; }
        .form-control-date { width: 100%; padding: 15px; border: 1px solid #e0e0e0; border-radius: 10px; font-size: 1em; background-color: #fff; color: #333; margin-bottom: 15px; }
        .selected-date-display { display: inline-block; background-color: #f8f7fc; color: #51245C; padding: 10px 20px; border-radius: 8px; font-weight: 600; border: 1px solid #e6e1f7; margin-bottom: 30px; }
        .sessions-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .session-badge { background-color: #f0f0f0; padding: 5px 15px; border-radius: 15px; font-size: 0.85em; color: #666; }
        .sessions-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .time-slot-card { border: 1px solid #e0e0e0; border-radius: 12px; padding: 25px 15px; text-align: center; background: white; cursor: pointer; transition: all 0.3s ease; position: relative; }
        .time-slot-card:hover { border-color: #A56CD1; box-shadow: 0 5px 15px rgba(165, 108, 209, 0.15); }
        .time-slot-card.selected { border: 2px solid #51245C; background-color: #fcfbff; }
        .time-slot-card.disabled { opacity: 0.5; cursor: not-allowed; background-color: #f9f9f9; }
        .slot-time { font-size: 1.2em; font-weight: 700; color: #51245C; margin-bottom: 5px; }
        .slot-duration { color: #888; font-size: 0.9em; margin-bottom: 15px; }
        .slot-status { display: inline-block; padding: 6px 16px; border-radius: 20px; font-size: 0.8em; font-weight: 700; letter-spacing: 0.5px; }
        .status-available { background-color: #d4edda; color: #155724; }
        .status-booked { background-color: #f8d7da; color: #721c24; }
        .reason-container { margin-top: 30px; }
        textarea.custom-textarea { width: 100%; border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; font-size: 0.95em; resize: vertical; min-height: 120px; background-color: #fff; }
        textarea.custom-textarea:focus { outline: none; border-color: #A56CD1; }
        .action-buttons { margin-top: 30px; text-align: right; }
        .btn-submit { background: #51245C; color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; transition: background 0.3s; }
        .btn-submit:hover { background: #6a3575; }

        @media (max-width: 1024px) { .sidebar { width: 240px; } .main-content { margin-left: 240px; } .sessions-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .sidebar { transform: translateX(-100%); transition: transform 0.3s; z-index: 1000; } .sidebar.active { transform: translateX(0); } .main-content { margin-left: 0; padding: 20px; } .sessions-grid { grid-template-columns: 1fr; } }

        /* --- NEW: CUSTOM MODAL STYLES --- */
        .modal-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            transform: translateY(20px);
            animation: slideUp 0.3s ease forwards;
        }

        .success-icon {
            font-size: 4em;
            color: #28a745;
            margin-bottom: 20px;
        }

        .modal-title {
            color: #51245C;
            font-size: 1.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .modal-details {
            background-color: #f8f7fc;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
            border: 1px solid #e6e1f7;
        }

        .modal-detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .modal-detail-row:last-child { margin-bottom: 0; }
        .detail-label { color: #888; font-weight: 500; }
        .detail-value { color: #333; font-weight: 600; text-align: right; max-width: 60%; }

        .btn-modal-close {
            background: #51245C;
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(81, 36, 92, 0.3);
        }

        .btn-modal-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(81, 36, 92, 0.4);
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">
            <div class="user-info">
                <div class="avatar">AA</div>
                <p>Anis Azwani</p>
                <small>Student ID: 2025123456</small>
                <small>Faculty: Computer Science</small>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li><a href="studentDashboard.html"><i class="fas fa-chart-bar"></i> Dashboard</a></li>
            <li class="active"><a href="appointmentStud.html"><i class="far fa-calendar-alt"></i> Appointment</a></li>
            <li><a href="manageAppStud.html"><i class="far fa-comments"></i> Manage Appointment</a></li>
            <li><a href="profile.html"><i class="far fa-user"></i> Profile</a></li>
            <li><a href="historyStud.html"><i class="far fa-clock"></i> History</a></li>
            <li class="logout"><a href="login.html"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="booking-container">
            <form id="bookingForm">
                
                <div class="date-input-container">
                    <label class="section-label"><i class="far fa-calendar-alt"></i> Select Appointment Date</label>
                    <input type="date" id="appointmentDate" class="form-control-date" required>
                    <div id="selectedDateDisplay" class="selected-date-display" style="display: none;"></div>
                </div>

                <div>
                    <div class="sessions-header">
                        <label class="section-label" style="margin-bottom:0;"><i class="far fa-clock"></i> Available Sessions <span style="font-size: 0.7em; background:#e0e0e0; padding:2px 6px; border-radius:4px; margin-left:5px;">24-Hour</span></label>
                        <span class="session-badge" id="sessionCountBadge">Select a date</span>
                    </div>
                    <div class="sessions-grid" id="sessionsGrid"></div>
                    <input type="hidden" id="selectedSlotId" name="selectedSlotId">
                </div>

                <div class="reason-container">
                    <label class="section-label"><i class="far fa-comment-dots"></i> Reason for Appointment</label>
                    <textarea id="appointmentReason" class="custom-textarea" placeholder="Enter reason for the appointment..."></textarea>
                </div>

                <div class="action-buttons">
                    <button type="submit" class="btn-submit">Book Appointment</button>
                </div>
            </form>
        </div>
    </div>

    <div id="successModal" class="modal-overlay">
        <div class="modal-content">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="modal-title">Booking Confirmed!</h2>
            <p style="color: #666; margin-bottom: 20px;">Your appointment has been successfully scheduled.</p>
            
            <div class="modal-details">
                <div class="modal-detail-row">
                    <span class="detail-label">Date:</span>
                    <span class="detail-value" id="modalDate"></span>
                </div>
                <div class="modal-detail-row">
                    <span class="detail-label">Time:</span>
                    <span class="detail-value" id="modalTime"></span>
                </div>
            </div>

            <button class="btn-modal-close" onclick="closeModal()">Done</button>
        </div>
    </div>

    <script>
        const dailySlots = [
            { id: 1, start: "09:00", end: "10:00", duration: "1 hour" },
            { id: 2, start: "10:00", end: "11:00", duration: "1 hour" },
            { id: 3, start: "11:00", end: "12:00", duration: "1 hour" },
            { id: 4, start: "14:00", end: "15:00", duration: "1 hour" },
            { id: 5, start: "16:00", end: "17:00", duration: "1 hour" },
            { id: 6, start: "18:00", end: "19:00", duration: "1 hour" }
        ];

        const bookedDatabase = {};

        const dateInput = document.getElementById('appointmentDate');
        const dateDisplay = document.getElementById('selectedDateDisplay');
        const sessionsGrid = document.getElementById('sessionsGrid');
        const sessionCountBadge = document.getElementById('sessionCountBadge');
        const selectedSlotInput = document.getElementById('selectedSlotId');
        
        // Modal Elements
        const successModal = document.getElementById('successModal');
        const modalDateSpan = document.getElementById('modalDate');
        const modalTimeSpan = document.getElementById('modalTime');

        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            dateInput.setAttribute('min', todayStr);

            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            const y = tomorrow.getFullYear();
            const m = String(tomorrow.getMonth() + 1).padStart(2, '0');
            const d = String(tomorrow.getDate()).padStart(2, '0');
            const tomorrowStr = `${y}-${m}-${d}`;

            dateInput.value = tomorrowStr;
            const event = new Event('change');
            dateInput.dispatchEvent(event);
        });

        dateInput.addEventListener('change', function() {
            const dateVal = this.value;
            if(!dateVal) {
                dateDisplay.style.display = 'none';
                sessionsGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #888; padding: 20px;">Please select a date.</div>';
                return;
            }

            const dateObj = new Date(dateVal);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dateDisplay.textContent = dateObj.toLocaleDateString('en-US', options);
            dateDisplay.style.display = 'inline-block';

            renderSlots(dateVal);
        });

        function renderSlots(date) {
            sessionsGrid.innerHTML = ''; 
            selectedSlotInput.value = ''; 

            const bookedIds = bookedDatabase[date] || [];
            let availableCount = 0;

            dailySlots.forEach(slot => {
                const isBooked = bookedIds.includes(slot.id);
                if(!isBooked) availableCount++;

                const card = document.createElement('div');
                card.className = `time-slot-card ${isBooked ? 'disabled' : ''}`;
                if(!isBooked) {
                    card.onclick = () => selectSlot(card, slot.id);
                }

                card.innerHTML = `
                    <div class="slot-time">${slot.start} - ${slot.end}</div>
                    <div class="slot-duration">${slot.duration}</div>
                    <div class="slot-status ${isBooked ? 'status-booked' : 'status-available'}">
                        ${isBooked ? 'BOOKED' : 'AVAILABLE'}
                    </div>
                `;

                sessionsGrid.appendChild(card);
            });

            sessionCountBadge.textContent = `${availableCount} of ${dailySlots.length} sessions available`;
        }

        function selectSlot(cardElement, slotId) {
            const allCards = document.querySelectorAll('.time-slot-card');
            allCards.forEach(c => c.classList.remove('selected'));
            cardElement.classList.add('selected');
            selectedSlotInput.value = slotId;
        }

        // --- NEW MODAL FUNCTIONS ---

        function openModal(date, time) {
            // Populate data
            modalDateSpan.textContent = date;
            modalTimeSpan.textContent = time;
            
            // Show modal
            successModal.style.display = 'flex';
        }

        function closeModal() {
            successModal.style.display = 'none';
            // Optional: reset form after closing
            // document.getElementById('bookingForm').reset();
        }

        // Close modal if clicking outside the white box
        window.onclick = function(event) {
            if (event.target == successModal) {
                closeModal();
            }
        }

        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const date = dateInput.value;
            const slotId = selectedSlotInput.value;
            const reason = document.getElementById('appointmentReason').value;

            if(!date || !slotId) {
                alert("Please select a date and a time slot.");
                return;
            }

            const slotDetails = dailySlots.find(s => s.id == slotId);
            const timeString = `${slotDetails.start} - ${slotDetails.end}`;

            // Formatting date nicely for the modal
            const dateObj = new Date(date);
            const formattedDate = dateObj.toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' });

            // Trigger the custom modal instead of alert
            openModal(formattedDate, timeString);
        });
    </script>
</body>
</html>